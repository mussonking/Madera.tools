# ================================
# MADERA MCP SERVER - CONFIGURATION
# ================================
# Copy this file to .env and fill in your values

# ================================
# APPLICATION
# ================================
APP_ENV=development
SECRET_KEY=change-me-in-production-use-openssl-rand-hex-32
DEBUG=true

# ================================
# AI PROVIDERS
# ================================
# At least one API key required for training features
# Gemini is the default provider

# Google Gemini API Key
GEMINI_API_KEY=

# Anthropic Claude API Key (optional)
ANTHROPIC_API_KEY=

# OpenAI API Key (optional)
OPENAI_API_KEY=

# Which AI provider to use for training analysis
# Options: "gemini" | "claude" | "openai"
TRAINING_AI_PROVIDER=gemini

# ================================
# DATABASE - PostgreSQL
# ================================
# Independent database for MADERA (NOT LeClasseur DB)
DATABASE_URL=postgresql+asyncpg://madera:madera_password@localhost:5433/madera
DATABASE_URL_SYNC=postgresql://madera:madera_password@localhost:5433/madera

# ================================
# REDIS
# ================================
# For Celery task queue
REDIS_URL=redis://localhost:6380/0
CELERY_BROKER_URL=redis://localhost:6380/0
CELERY_RESULT_BACKEND=redis://localhost:6380/1

# ================================
# MINIO - Object Storage
# ================================
# Used for downloading files from presigned URLs
# Should match LeClasseur MinIO if integrating
MINIO_ENDPOINT=localhost:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_BUCKET=leclasseur
MINIO_SECURE=false

# ================================
# LEARNING & ANALYTICS
# ================================
# Enable automatic learning queue for low-confidence results
LEARNING_ENABLED=true

# Confidence threshold - results below this trigger learning queue
LOW_CONFIDENCE_THRESHOLD=0.75

# Log all tool executions to database for analytics
LOG_TOOL_EXECUTIONS=true

# Auto-process training queue (requires AI provider)
AUTO_PROCESS_TRAINING_QUEUE=false

# ================================
# MCP SERVER
# ================================
# Port for MCP server (stdio mode by default)
MCP_SERVER_PORT=8003

# ================================
# WEB UI
# ================================
# Port for training web interface
WEB_UI_PORT=8004
WEB_UI_HOST=0.0.0.0

# Enable training UI
TRAINING_UI_ENABLED=true

# ================================
# CELERY WORKERS
# ================================
# Number of concurrent Celery workers
CELERY_WORKER_CONCURRENCY=4

# Log level for Celery
CELERY_LOG_LEVEL=INFO

# ================================
# VISION & OCR
# ================================
# Path to Tesseract executable (auto-detected in Docker)
TESSERACT_CMD=/usr/bin/tesseract

# Default DPI for PDF to image conversion
PDF_TO_IMAGE_DPI=150

# Blank page detection thresholds
BLANK_PAGE_VARIANCE_THRESHOLD=100.0
BLANK_PAGE_DENSITY_THRESHOLD=0.02

# ================================
# TOOL DEFAULTS
# ================================
# Default tool class for new tools
DEFAULT_TOOL_CLASS=all_around

# Maximum file size for processing (in MB)
MAX_FILE_SIZE_MB=50

# Temp file cleanup age (in hours)
TEMP_FILE_CLEANUP_HOURS=24

# ================================
# LOGGING
# ================================
LOG_LEVEL=INFO
LOG_FORMAT=json

# ================================
# SECURITY
# ================================
# CORS origins for web UI (comma-separated)
CORS_ORIGINS=http://localhost:8004,http://localhost:3000

# API rate limiting
RATE_LIMIT_ENABLED=false
RATE_LIMIT_PER_MINUTE=60

# ================================
# INTEGRATION WITH LECLASSEUR
# ================================
# LeClasseur API URL (if integrating)
LECLASSEUR_API_URL=http://localhost:8000

# Shared secret for inter-service communication
LECLASSEUR_SHARED_SECRET=

# ================================
# DOCKER NETWORK
# ================================
# Internal Docker hostnames (when running in docker-compose)
# Uncomment these when running in Docker
# DATABASE_URL=postgresql+asyncpg://madera:madera_password@postgres-madera:5432/madera
# DATABASE_URL_SYNC=postgresql://madera:madera_password@postgres-madera:5432/madera
# REDIS_URL=redis://redis-madera:6379/0
# CELERY_BROKER_URL=redis://redis-madera:6379/0
# CELERY_RESULT_BACKEND=redis://redis-madera:6379/1
